# 챕터6) 교착 상태

## 교착상태의 정의

- `교착 상태(DeadLock)`: 2개 이상의 프로세스가 다른 프로세스의 작업이 끝나기만 기다리며 작업을 더 이상 진행하지 못하는 상황

> **아사 상태와의 차이점은?**
>
> - `아사 상태`: **운영체제가 잘못된 정책을 사용해서 특정 프로세스의 작업이 지연되는 상황 -> 에이징을 활용하여 해결**
> - `교착 상태`: **여러 프로세스가 작업을 진행하다보니 자연적으로 발생하는 문제 -> 강압적으로 교착상태를 해결해줘야함**

## 교착 상태의 발생

### (1) 시스템 자원

> - **다른 프로세스와 공유할 수 없는 자원을 사용할 때 발생한다.**
> - 프로세스1이 프린터를 할당받고 스캐너를 기다림
> - 프로세스2는 스캐너를 할당받고 프린터를 기다림
> - 어떻게 될까?

### (2) 잠금 (공유 변수)

> - **한 변수를 할당받은 상태에서 다른 변수를 기다리면?**

### (3) 응용 프로그램

> - **데이터베이스**
> - **DB는 데이터의 일관성을 유지하기 위해 잠금을 사용하는데 이때 발생한다.**

## 교착 상태의 필요조건

> - `상호배제(Mutual Exclusion)`: 한 프로세스가 사용하는 자원은 다른 프로세스와 공유할 수 없는 베타적인 자원이어야 한다.
> - `비선점(Non-Preemption)`: 한 프로세스가 사용중인 자원은 중간에 다른 프로세스가 빼앗을 수 없는 비선점 자원이어야 한다.
> - `점유와 대기(Hold and Wait)`: 프로세스가 어떤 자원을 할당받은 상태에서 다른 자원을 기다리는 상태여야 한다.
> - `원형대기 (Circular Wait)`: 점유와 대기를 하는 프로세스간에 관계가 원을 이루어야 한다.

## 교착 상태의 해결방법

> - `교착상태 예방`: 교착상태를 유발하는 4가지 조건이 발생하지 않도록 무력화하는 방식
> - `교착상태 회피`: 교착상태가 발생하지 않도록 자원 할당량을 조절하는 방식
> - `교착상태 검출`: 자원 할당 그래프를 모니터링 하면서 교착상태가 발생하는지 살펴보는 방식
> - `교착상태 회복`: 교착상태가 발생한 후 회복단계 진행

### 예방

- 자원을 핸들링하는 상호 배제와 비선점은 무리가 있다. (아사현상 등)
- 점유와 대기와 원형 대기는 프로세스 작업 방식을 제한하고 자원을 낭비하기 때문에 무리가 있다.

### 회피

- 프로세스에 자원을 할당할 때 어느 수준 이상의 자원을 나누어 주면 교착 상태가 발생하는지 파악해서 그 수준 이하로 자원을 나눠주는 방법
- 교착상태가 발생하지 않는 범위 내에서만 할당하고 그 외는 대기시킨다.
- 안정상태와 불안정 상태
- `은행원 알고리즘(Banker's Algorithm)`: 대출금액이 대출 가능한 범위 내이면 허용되지만 그렇지 않으면 거부되는 것

`프로세스가 자신이 사용할 모든 자원을 미리 선언해야 한다는 점`, `시스템의 전체 자원수가 고정적이어야 한다는 점` 그리고 `자원이 낭비된다는 단점`이 있다.

### 검출

> **운영체제가 프로세스의 작업을 관찰하면서 교착 상태 발생 여부를 계속 주시하는 방식이다. 교착 상태를 발견하는 즉시 회복으로 들어간다.**

- `타임아웃`을 이용한 교착 상태 검출: **일정시간 작업이 진행되지 않으면 교착상태라고 판단.**
- `데이터베이스`에서 타임아웃 문제: 타임아웃으로 프로세스가 종료되면 데이터의 일관성이 깨질 수 있음 -> `체크포인트와 롤백, 스냅샷`
- `자원 할당 그래프`를 이용한 교착 상태 검출

### 회복

> **교착상태를 유발한 프로세스를 강제 종료하는 방식**

- **교착상태를 일으킨 모든 프로세스를 동시에 종료**
- **하나를 골라서 순서대로 종료 (우선순위, 자원 사용량 고려해서 종료)**
