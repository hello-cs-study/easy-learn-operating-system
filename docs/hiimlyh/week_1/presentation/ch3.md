# CH3 프로세스와 스레드

## ✅ 프로세스

💻 운영체제에서 프로세스는 하나의 작업 단위로서 정의되며, 누군가가 작성한 프로그램이 실행되면 프로세스가 된다.

- **프로그램:** 저장장치에 저장된 정적인 상태
    - 프로세스 - 프로세스 제어 블록(PCB)
- **프로세스:** 실행을 위해 메모리에 올라온 동적인 상태
    - 프로그램 + 프로세스 제어 블록(PCB)

  프로그램이 프로세스가 된다는 것은 운영체제로부터 프로세스 제어 블록이 폐기된다는 뜻

- **일괄 작업 방식:** 한 개가 끝나야 다음 것이 가능
- **시분할 방식:** 배분해서 여러가지 동시에 수행

### 📶 프로세스의 다섯 가지 상태

1. 생성 상태: 프로세스가 메모리에 올라와 실행 준비를 완료한 상태 제어블록 생성(프로그램 + PCB)
2. 준비 상태: 실행 대기중인 모든 프로세스가 자기 순서를 기다리는 상태 PCB는 준비 큐에서 기다리며 CPU 스케줄러에 의해 관리
3. 실행 상태: 선택된 프로세스가 타임 슬라이스를 얻어 CPU를 사용하는 상태 작업을 마치면 완료 상태
4. 대기 상태: 실행 상태에 있는 프로세스가 입출력을 요청하면 입출력이 완료될 때까지 기다리는 상태. 입출력이 완료되면 준비상태로 이동한다
5. 완료 상태: 프로세스가 종료된 상태, 사용하던 모든 자원 반납, 메모리와 PCB 제거

**휴식 상태와 보류 상태**

> 대부분의 프로세스는 생성, 준비, 실행, 대기, 완료 상태로 운영되며 이 다섯 가지 상태를 활성 상태라고 한다.
>
- 휴식 상태: 프로세스가 작업을 일시적으로 쉬고있는 상태
- 프로세스가 메모리에서 잠시 쫓겨난 상태 “일시 정지 상태”

## 프로세스 제어 블록과 문맥 교환

**프로세스 제어 블록(PCB)**

- 프로세스를 실행하는데 필요한 중요한 정보를 보관하는 자료 구조(TCB: Task Control Block)

**PCB에 저장되는 주요 정보**

- **프로세스 식별자(PID)**: 각 프로세스의 고유 ID
- **프로세스 상태**: 생성, 준비, 실행, 대기, 보류 준비, 보류 대기
- **프로그램 카운터**: 다음에 실행할 명령어의 주소
- **각종 레지스터 정보**: 프로세스가 사용하던 레지스터 값들, 우선순위, 스케줄링 큐 포인터 등
- **메모리 관리 정보**: 메모리 경계, 페이지 테이블 등
- **입출력 상태 정보**: 할당된 I/O 장치 목록, 열린 파일 목록 등
- **계정 정보**: 계정 번호, CPU 사용 시간, CPU 활용 시간, 프로세스 번호 등
- **부모-자식 관계**: 부모 프로세스 ID(PPID), 자식 프로세스 ID(CPID)

**문맥교환 (Context switching)**

문맥 교환은 CPU가 한 프로세스에서 다른 프로세스로 전환될 때, 이전 프로세스의 상태(문맥)를 저장하고 새로운 프로세스의 상태를 복원하는 과정

## **✅** 프로세스의 연산

### 프로세스의 구조

- **코드 영역:** 프로그램의 본문이 기술되어있다.
    - main () {

      int da = 2, fa = 3;

      printf(”add %d \n”, da+fa);

      exit();

      }

- **데이터 영역:** 코드가 실행되면서 사용되는 변수나 파일등의 각종 데이터를 모아 놓은 곳
    - int  da = 2, fa =3;
- **스택 영역:** 운영체제가 프로세스를 실행하기 위해 부수적으로 필요한 데이터를 모아 놓은 곳
    - Return address 180;

### 프로세스의 복사와 전환

**`fork()` 시스템 호출**

- 실행중인 프로세스로부터 새로운 프로세스를 복사하는 함수이다 (커널에서 제공). 이 때 실행중이었던 프로세스는 부모 프로세스, 새로 생긴 프로세스는 자식 프로세스로서 부모-자식 관계가 된다.
- **장점:** 프로세스의 생성속도가 빠르다(메모리에서 복사하기 때문), 추가 작업 없이 자원을 상속 할 수 있다, 시스템 관리를 효율적으로 할 수 있다.

**`exec()` 시스템 호출**

- 기존의 프로세스를 새로운 프로세스로 전환하는 함수이다. 이미 만들어진 프로세스의 구조를 재활용하는 것

### 

## 프로세스 관리

### 프로세스 계층 구조의 장점

- **병렬 처리**: 여러 작업을 동시에 처리 가능
- **코드 재사용**: 프로세스 재사용이 용이함
- **자원 관리**: 자원 회수가 효율적으로 이루어짐

### Orphan 프로세스

부모 프로세스가 고아 프로세스보다 먼저 종료되어 돌아갈 곳이 없는 프로세스를 가르킨다.

- **정의**: 부모 프로세스가 적절히 회수하지 않아 시스템에 남아있는 프로세스
- **해결 방법**: C언어의 `exit()` 또는 `return()`을 통해 자식 프로세스가 종료를 부모에게 알림
- **문제점**: 고아 프로세스는 시스템 자원을 낭비하여 OS 효율성을 저하시킴

## 스레드

### 스레드 정의

프로세스의 코드에 정의된 절차에 따라 CPU에 작업 요청을 하는 실행 단위다.

- CPU 스케줄러가 CPU에 전달하는 작업의 기본 단위
- 프로세스의 코드에 정의된 절차에 따라 실행되는 단위
- 처리 단위 계층: CPU > 프로세스 > 스레드

### 프로세스와 스레드의 차이

- 프로세스는 서로 **약하게 연결** (독립적)
- 스레드는 서로 **강하게 연결** (같은 자원 공유)

### 다양한 실행 모델

- **멀티스레드**: 하나의 프로세스 내에서 여러 스레드로 작업을 **분할**하여 처리
- **멀티태스킹(fork)**: CPU 시간을 잘게 나누어 여러 프로세스에 배분
- **멀티프로세싱**: **여러 CPU**를 사용하여 여러 스레드를 동시에 처리 (슈퍼스칼라 기법)
- **CPU 멀티스레드**: 하나의 CPU에서 여러 스레드를 동시에 처리 (파이프라인 기법)

### 멀티스레드의 장점

- **응답성 향상**: 일부 스레드가 블록되어도 다른 스레드는 계속 실행 가능
- **자원 공유**: 메모리와 자원을 효율적으로 공유
- **효율성 향상**: 문맥 교환 비용 감소
- **다중 CPU 활용**: 병렬 처리를 통한 성능 향상

### 멀티스레드의 단점

- **오류 전파**: 하나의 스레드에 문제가 생기면 전체 프로세스에 영향
- **동기화 문제**: 공유 자원에 대한 접근 제어 필요
- **디버깅 복잡성**: 멀티스레드 프로그램의 디버깅이 어려움

## 스레드 모델

### 사용자 레벨 스레드

- **특징**: 사용자 프로세스 내에 여러 스레드가 커널의 단일 스레드와 연결
- **장점**: 문맥 교환이 빠름 (커널 개입 최소화)
- **단점**: 한 스레드가 블록되면 전체 프로세스가 블록될 수 있음

### 커널 레벨 스레드

- **특징**: 각 스레드가 독립적인 커널 스레드에 연결
- **장점**: 한 스레드가 블록되어도 다른 스레드는 계속 실행 가능
- **단점**: 문맥 교환이 느림 (커널 개입 필요)

### 멀티레벨 스레드

- **특징**: 사용자 레벨과 커널 레벨 스레드를 혼합한 방식
- **장점**: 유연한 작업 처리 및 병렬성 향상
- **실제 사용**: 최근 대부분의 운영체제에서 채택

### 프로세스 VS 스레드 비교

| 특성 | 프로세스 | 스레드 |
| --- | --- | --- |
| 메모리 공간 | 독립적 | 공유(코드, 데이터, 힙) |
| 통신 방식 | IPC 필요 | 직접 통신 가능 |
| 문맥 교환 비용 | 높음 | 낮음 |
| 오류 영향 범위 | 해당 프로세스만 | 전체 프로세스 |

### 스레드 동기화

멀티스레드 환경에서는 공유 자원에 대한 접근을 조율하기 위해 동기화 메커니즘(뮤텍스, 세마포어 등)이 필요합니다. 이는 데이터 일관성을 유지하고 경쟁 상태(Race Condition)를 방지합니다.

### 스레드 스케줄링

운영체제는 다양한 스케줄링 알고리즘을 사용하여 CPU 시간을 스레드에 할당합니다. 우선순위 기반, 라운드 로빈, 타임 슬라이싱 등의 방식이 활용됩니다.

참고 :[https://newbie-in-softengineering.tistory.com/entry/OS-Ch3-프로세스와-스레드](https://newbie-in-softengineering.tistory.com/entry/OS-Ch3-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%EC%99%80-%EC%8A%A4%EB%A0%88%EB%93%9C)